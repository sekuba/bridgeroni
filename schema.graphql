# Raw events with enhanced metadata for TUI display
type MessageTransmitter_MessageReceived {
  id: ID!
  caller: String!
  sourceDomain: BigInt!
  nonce: BigInt!
  sender: String!
  messageBody: String!
  # Enhanced metadata
  chainId: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  txHash: String!
}

# CCTPv2 MessageReceived event
type MessageTransmitter_MessageReceivedV2 {
  id: ID!
  caller: String!
  sourceDomain: BigInt!
  nonce: String!  # bytes32 in v2
  sender: String!
  finalityThresholdExecuted: BigInt!
  messageBody: String!
  # Enhanced metadata
  chainId: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  txHash: String!
}

type TokenMessenger_DepositForBurn {
  id: ID!
  nonce: BigInt!
  burnToken: String!
  amount: BigInt!
  depositor: String!
  mintRecipient: String!
  destinationDomain: BigInt!
  destinationTokenMessenger: String!
  destinationCaller: String!
  # Enhanced metadata
  chainId: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  txHash: String!
}

# CCTPv2 DepositForBurn event
type TokenMessenger_DepositForBurnV2 {
  id: ID!
  burnToken: String!
  amount: BigInt!
  depositor: String!
  mintRecipient: String!
  destinationDomain: BigInt!
  destinationTokenMessenger: String!
  destinationCaller: String!
  maxFee: BigInt!
  minFinalityThreshold: BigInt!
  hookData: String!
  # Enhanced metadata
  chainId: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  txHash: String!
}

# LayerZero v2 PacketSent event
type EndpointV2_PacketSent {
  id: ID!
  encodedPayload: String!
  options: String!
  sendLibrary: String!
  # Enhanced metadata
  chainId: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  txHash: String!
}

# LayerZero v2 PacketDelivered event  
type EndpointV2_PacketDelivered {
  id: ID!
  originSrcEid: BigInt!
  originSender: String!
  originNonce: BigInt!
  receiver: String!
  # Enhanced metadata
  chainId: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  txHash: String!
}

# LayerZero packet transfer entity for matching sent/delivered packets
type LayerZeroPacket @entity {
  id: ID!

  # === Core identifiers ===
  srcEid: BigInt!
  dstEid: BigInt
  nonce: BigInt!
  sender: String!
  receiver: String!

  # === Source-side data ===
  encodedPayload: String
  options: String
  sendLibrary: String
  sourceTxHash: String
  sentBlock: BigInt
  sentTimestamp: BigInt

  # === Destination-side data ===
  destinationTxHash: String
  deliveredBlock: BigInt
  deliveredTimestamp: BigInt

  # === Derived fields ===
  latencySeconds: BigInt
  matched: Boolean!
  payload: String              # Decoded payload (everything after header)
  
  # === Computed fields for TUI efficiency ===
  hasPayload: Boolean!         # true if payload is not null/empty
  sourceChainId: BigInt        # chain ID where packet was sent
  destinationChainId: BigInt   # chain ID where packet was delivered
  eventType: String!           # "sent", "delivered", or "matched"
  lastUpdated: BigInt!         # timestamp of last update to this record
}

type CCTPTransfer @entity {
  id: ID!

  # === Core identifiers ===
  sourceDomain: BigInt!
  destinationDomain: BigInt
  nonce: String!  # Support both BigInt (v1) and bytes32 (v2) as string
  version: String!             # "v1" or "v2"

  # === Source-side data ===
  amount: BigInt
  burnToken: String
  depositor: String
  mintRecipient: String
  sourceTxHash: String
  depositBlock: BigInt
  depositTimestamp: BigInt

  # === CCTP v2 specific fields ===
  maxFee: BigInt               # v2 only
  minFinalityThreshold: BigInt # v2 only  
  hookData: String             # v2 only
  finalityThresholdExecuted: BigInt # v2 only (destination side)

  # === Destination-side data ===
  destinationTxHash: String
  messageReceivedBlock: BigInt
  messageReceivedTimestamp: BigInt

  # === Derived fields ===
  latencySeconds: BigInt
  matched: Boolean!
  
  # === Computed fields for TUI efficiency ===
  hasAmount: Boolean!           # true if amount is not null (for display logic)
  sourceChainId: BigInt        # chain ID where deposit occurred
  destinationChainId: BigInt   # chain ID where message was received
  eventType: String!           # "deposit", "received", or "matched"
  lastUpdated: BigInt!         # timestamp of last update to this record
}